version: '3.8'

services:
  # 1. The Local Graph Database
  neo4j:
    image: neo4j:5
    container_name: postureprompt-db
    restart: unless-stopped
    ports:
      - "7474:7474" # Neo4j Browser UI (For you to visually see the data)
      - "7687:7687" # Bolt Protocol (For the Python app to query the data)
    environment:
      - NEO4J_AUTH=neo4j/PosturePromptSecure2026!
      # APOC is a required plugin for advanced data ingestion and formatting
      - NEO4J_PLUGINS=["apoc"] 
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
    networks:
      - posture_network

  # 2. The Python AI Backend
  api:
    build: .
    container_name: postureprompt-api
    restart: unless-stopped
    ports:
      - "8000:8000" # FastAPI web server port
    environment:
      # Internal Docker routing to connect to the database
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=PosturePromptSecure2026!
      # Azure credentials will be passed through your .env file
    depends_on:
      - neo4j
    volumes:
      # Syncs your local code into the container for live-reloading
      - .:/code
    networks:
      - posture_network

volumes:
  neo4j_data:
  neo4j_logs:

networks:
  posture_network:
    driver: bridge
